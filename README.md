```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                          â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—       â•‘
â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘       â•‘
â•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘       â•‘
â•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘         â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘       â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘       â•‘
â•‘   â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â•   â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â•     â•‘
â•‘                                                                          â•‘
â•‘            Intelligente Dokumentenerkennung fÃ¼r macOS                    â•‘
â•‘                            v2.4.1                                        â•‘
â•‘                                                                          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)
[![macOS](https://img.shields.io/badge/macOS-Monterey%2B-blue)](https://www.apple.com/macos/)
[![Node.js](https://img.shields.io/badge/Node.js-18%2B-green)](https://nodejs.org/)
[![OCR](https://img.shields.io/badge/OCR-Tesseract-orange)](https://github.com/tesseract-ocr/tesseract)
[![Version](https://img.shields.io/badge/Version-2.4.1-brightgreen)](package.json)

---

**Was macht doc-scan?** â€” Erkennt Dokumente (Firma, Typ, Datum) und benennt Dateien intelligent um. Aus `scan001.pdf` wird `2024-01-24_Vodafone_Rechnung_VF-12345.pdf`. Optional mit AI-UnterstÃ¼tzung via Perplexity API.

---

## Features

- **AI-gestÃ¼tzte Analyse** â€” Perplexity API erkennt *alle* Firmen, nicht nur vordefinierte (optional)
- **OCR** â€” Gescannte PDFs und Bilder via Tesseract
- **Multi-Format** â€” PDF, DOCX, Pages, TXT, PNG, JPG
- **Batch-Verarbeitung** â€” `doc-scan ~/Downloads/*.pdf --execute`
- **Undo** â€” Letzte Umbenennung rÃ¼ckgÃ¤ngig machen
- **macOS Integration** â€” Finder Quick Action (Rechtsklick)
- **Security** â€” Input Validation, Path Traversal Protection, API Key Protection
- **Geburtsdatum-Schutz** â€” Verhindert Fehlerkennungen bei Briefkopf-Analysen

### Erkennungs-Engine

| Was | Beispiele |
|-----|-----------|
| **Absender** | 40+ Firmen (Allianz, Vodafone, Amazon, ...) â€” mit AI unbegrenzt |
| **Dokumenttyp** | Rechnung, Vertrag, Bescheid, Mahnung, KÃ¼ndigung, Kontoauszug, ... |
| **Datum** | Scanner-Zeitstempel â†’ Briefdatum (OCR) â†’ Erstelldatum (Fallback) |
| **Referenznummern** | Rechnungs-Nr, Kunden-Nr, Vertrags-Nr, Policen-Nr, Aktenzeichen |
| **Keywords** | AI extrahiert bis zu 5 Buzzwords aus dem Inhalt |

### UnterstÃ¼tzte Formate

| Format | Methode |
|--------|---------|
| PDF | Textextraktion + OCR-Fallback (pdftoppm â†’ Tesseract) |
| DOCX | mammoth.js |
| Pages | ZIP-Extraktion |
| TXT | UTF-8/Latin-1 |
| PNG / JPG / JPEG | OCR via Tesseract |
| DOC, XLS/XLSX, PPT/PPTX, Numbers, Keynote, ODT | Dateiname wird beibehalten (kein Text extrahierbar) |

---

## Installation

```bash
# Voraussetzungen
brew install node                       # Node.js 18+
brew install tesseract tesseract-lang   # OCR (optional)

# Installieren
git clone https://github.com/AndreasDietzel/document-scanner.git
cd document-scanner
npm install
npm run build
npm link                                # macht "doc-scan" global verfÃ¼gbar
```

**Test:**
```bash
doc-scan --help
```

### AI einrichten (optional)

```bash
doc-scan --setup
# â†’ "AI-Enhancement aktivieren?" â†’ Ja
# â†’ Perplexity API-Key eingeben (https://www.perplexity.ai/settings/api)
```

Oder manuell in `~/.doc-scan.json`:
```json
{
  "enableAI": true,
  "perplexityApiKey": "pplx-your-key-here"
}
```

Mehr dazu: [AI-INTEGRATION.md](AI-INTEGRATION.md)

---

## Verwendung

```bash
# Vorschau (Standard) â€” analysiert ohne Umbenennung
doc-scan rechnung.pdf

# Umbenennen
doc-scan rechnung.pdf --execute

# Batch
doc-scan ~/Downloads/*.pdf --execute

# Verbose Debug-Ausgabe
doc-scan rechnung.pdf --preview --verbose

# Undo
doc-scan --undo

# Setup-Wizard
doc-scan --setup
```

### Alle Flags

| Flag | Beschreibung |
|------|-------------|
| `--preview` | Analysiert ohne Umbenennung (Standard) |
| `--execute` | Benennt automatisch um |
| `--silent` | Keine macOS-Benachrichtigungen |
| `--verbose` | Detaillierte Debug-Ausgabe |
| `--setup` | Interaktiver Setup-Wizard |
| `--undo` | Letzte Batch-Umbenennung rÃ¼ckgÃ¤ngig machen |
| `--undo-stats` | Undo-Statistiken anzeigen |
| `--help` | Hilfe |

---

## Beispiele

### Umbenennung

| Vorher | Nachher | Erkannt |
|--------|---------|---------|
| `scan001.pdf` | `2024-01-24_Vodafone_Rechnung_VF-12345.pdf` | Datum, Firma, Typ, Referenz-Nr |
| `document.docx` | `2023-12-31_Allianz_Vertrag_POL-9876.docx` | Datum, Firma, Vertrag, Policen-Nr |
| `IMG_0123.jpg` | `2025-03-15_Techniker_Krankenkasse_Bescheid.jpg` | Datum, Firma, Typ |

### AI-Analyse Output

```
ğŸ¤– AI-Analyse lÃ¤uft...
âœ“ Dokumenttyp: Rechnung (95% Konfidenz)
âœ“ Firma: Vodafone GmbH
âœ“ Keywords: Mobilfunk, LTE, Datenvolumen, GrundgebÃ¼hr
   â†’ 2025-05-15_Vodafone_Mobilfunkrechnung_LTE_RG-2024-987654.pdf
```

### Batch-Verarbeitung

```bash
doc-scan ~/Downloads/*.pdf --preview

# ============================================================
# ğŸ“Š ZUSAMMENFASSUNG - 15 Dateien verarbeitet
# ============================================================
# âœ… Erfolgreich: 15
# ğŸ“ Umbenannt: 0
# â­ï¸  Ãœbersprungen: 3
# âŒ Fehler: 0
```

---

## Konfiguration

Die Konfiguration liegt in `~/.doc-scan.json` und wird Ã¼ber `doc-scan --setup` erstellt.

```json
{
  "defaultMode": "preview",
  "enableOCR": true,
  "ocrLanguage": "deu",
  "customCompanies": ["Meine Firma GmbH"],
  "enableAI": false,
  "perplexityApiKey": "",
  "aiConfidenceThreshold": 0.5,
  "birthDate": "01.01.1990"
}
```

| Feld | Beschreibung |
|------|-------------|
| `defaultMode` | `preview` oder `execute` |
| `enableOCR` | OCR fÃ¼r gescannte PDFs/Bilder |
| `ocrLanguage` | Tesseract-Sprache (`deu`, `eng`, ...) |
| `customCompanies` | Eigene Firmennamen zur Erkennung |
| `enableAI` | Perplexity AI aktivieren |
| `perplexityApiKey` | API-Key (lokal gespeichert, nie committed) |
| `aiConfidenceThreshold` | Minimum-Konfidenz fÃ¼r AI-Ergebnisse (0-1) |
| `birthDate` | Geburtsdatum â€” wird bei Datumserkennung ignoriert |

---

## macOS Finder Integration

Quick Action einrichten fÃ¼r Rechtsklick â†’ "Dokument scannen":

1. Automator Ã¶ffnen â†’ **Schnellaktion** erstellen
2. "Shell-Script ausfÃ¼hren" hinzufÃ¼gen
3. Script einfÃ¼gen (siehe [MACOS-KONTEXTMENU.md](MACOS-KONTEXTMENU.md))
4. Als "ğŸ” Dokument scannen" speichern
5. **Fertig** â€” Rechtsklick auf Dateien â†’ Schnellaktionen â†’ ğŸ” Dokument scannen

Optional: Keyboard Shortcut zuweisen unter Systemeinstellungen â†’ Tastatur â†’ Kurzbefehle â†’ Dienste.

---

## Projekt-Struktur

```
document-scanner/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cli.ts              # Haupt-CLI
â”‚   â”œâ”€â”€ config.ts           # Konfigurationsmanagement
â”‚   â”œâ”€â”€ ai-analysis.ts      # Perplexity AI Integration
â”‚   â”œâ”€â”€ security.ts         # Security & Validierung
â”‚   â”œâ”€â”€ setup.ts            # Setup-Wizard
â”‚   â””â”€â”€ undo.ts             # Undo-FunktionalitÃ¤t
â”œâ”€â”€ build/                  # Kompilierte JS-Dateien
â”œâ”€â”€ test-data/              # Testdateien
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â””â”€â”€ LICENSE
```

### Entwicklung

```bash
npm run build       # TypeScript kompilieren
npm run watch       # Watch-Modus
node build/cli.js test-data/test-rechnung.txt --preview   # Lokaler Test
```

---

## Troubleshooting

**`doc-scan: command not found`** â€” `npm link` im Repo-Verzeichnis ausfÃ¼hren.

**Quick Action erscheint nicht** â€” Systemeinstellungen â†’ Erweiterungen â†’ Finder â†’ aktivieren.

**OCR funktioniert nicht** â€” `brew install tesseract tesseract-lang`, dann `tesseract --list-langs` prÃ¼fen (muss `deu` enthalten).

**"Keine Textinhalte gefunden"** â€” OCR nicht installiert, Datei beschÃ¤digt, oder Bild ohne Text. Debug mit `doc-scan datei.pdf --verbose`.

---

## Dokumentation

- [AI-INTEGRATION.md](AI-INTEGRATION.md) â€” Perplexity AI Setup & Verwendung
- [MACOS-KONTEXTMENU.md](MACOS-KONTEXTMENU.md) â€” Automator Quick Action Setup
- [SECURITY.md](SECURITY.md) â€” Security & ISO 25010
- [CHANGELOG.md](CHANGELOG.md) â€” Versionshistorie

---

## Lizenz

MIT â€” siehe [LICENSE](LICENSE)

**Andreas Dietzel** â€” [@AndreasDietzel](https://github.com/AndreasDietzel)
